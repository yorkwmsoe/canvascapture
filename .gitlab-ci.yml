stages:
  - ğŸ‹ docker
  - ğŸ› install
  - ğŸ¤ test
  - ğŸ“¦ build
  - ğŸš€ release

include:
  - local: /apps/cli/.cli-ci.yml
  - local: /apps/desktop/.desktop-ci.yml

build-docker-cli:
  stage: ğŸ‹ docker
  image: docker:stable
  services:
    - docker:dind
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker build ./docker -f ./docker/Dockerfile.cli -t $CI_REGISTRY_IMAGE/cli
    - docker push $CI_REGISTRY_IMAGE/cli
  rules:
    - changes:
        - /docker/Dockerfile.cli

build-docker-desktop:
  stage: ğŸ‹ docker
  image: docker:stable
  services:
    - name: docker:dind
      alias: docker
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker build ./docker -f ./docker/Dockerfile.desktop -t $CI_REGISTRY_IMAGE/desktop
    - docker push $CI_REGISTRY_IMAGE/desktop
  rules:
    - changes:
        - /docker/Dockerfile.desktop
